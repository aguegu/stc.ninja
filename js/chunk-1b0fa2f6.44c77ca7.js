(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b0fa2f6"],{"116b":function(e,t,r){},"33b8":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",{staticStyle:{height:"100%"},attrs:{fluid:""}},[r("v-alert",{attrs:{dense:"",outlined:"",type:"warning"},model:{value:e.isSerialUnsupported,callback:function(t){e.isSerialUnsupported=t},expression:"isSerialUnsupported"}},[e._v('This browser "'+e._s(e.userAgent)+'" does not support '),r("a",{staticClass:"warning--text",attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Serial"}},[e._v("Web Serial API")]),e._v(" yet.")]),r("v-card",{staticClass:"d-flex flex-column",staticStyle:{height:"100%"}},[r("v-card-title",{staticClass:"d-flex flex-row pb-2"},[r("v-btn",{staticClass:"mr-2 text-none",attrs:{small:"",disabled:e.isConnected||e.isSerialUnsupported},on:{click:e.requestPort}},[e._v("Select Serial Port")]),e.port&&e.isConnected?r("v-btn",{staticClass:"mr-2 text-none",attrs:{small:"",color:"warning"},on:{click:e.closePort}},[e._v("Close Port")]):e._e(),r("v-file-input",{staticStyle:{"max-width":"320px"},attrs:{accept:".hex","hide-details":"",dense:""},on:{change:e.importTxt,"click:clear":function(t){e.bin=null}},model:{value:e.hex,callback:function(t){e.hex=t},expression:"hex"}}),r("v-btn",{staticClass:"text-none ml-2",attrs:{small:"",color:"primary",disabled:!e.port||!e.bin||e.isConnected},on:{click:e.flash}},[e._v("Flash")]),r("v-btn",{staticClass:"text-none ml-2",attrs:{small:"",disabled:!e.port||e.isConnected},on:{click:e.readFuse}},[e._v("Read Fuse")]),r("span",{staticClass:"font-weight-light text-overline ml-4"},[e._v("For STC15 (FWVER > 0x72)")]),r("span",{staticClass:"font-weight-light text-overline ml-4"},[e._v("arg: "+e._s(e.arg.toString(16)))]),r("span",{staticClass:"font-weight-light text-overline ml-4"},[e._v("fwver: "+e._s(e.fwver.toString(16)))]),r("v-spacer"),r("v-switch",{staticClass:"ml-4 mt-0",attrs:{label:"More Options","hide-details":""},model:{value:e.forms.setup.isVisible,callback:function(t){e.$set(e.forms.setup,"isVisible",t)},expression:"forms.setup.isVisible"}})],1),r("v-card-text",{ref:"terminalContainer",staticClass:"px-4"},[e.forms.setup.isVisible?r("v-form",{staticClass:"d-flex flex-row py-4"},[r("v-select",{staticClass:"fit px-2",staticStyle:{"max-width":"16rem"},attrs:{"hide-details":"",items:e.forms.setup.handshakeBaudrates,label:"Handshake Baudrate",dense:""},model:{value:e.forms.setup.payload.handshakeBaudrate,callback:function(t){e.$set(e.forms.setup.payload,"handshakeBaudrate",t)},expression:"forms.setup.payload.handshakeBaudrate"}}),r("v-select",{staticClass:"fit px-2",staticStyle:{"max-width":"16rem"},attrs:{"hide-details":"",items:e.forms.setup.flashBaudRates,label:"Flash Baudrate",dense:""},model:{value:e.forms.setup.payload.flashBaudRate,callback:function(t){e.$set(e.forms.setup.payload,"flashBaudRate",t)},expression:"forms.setup.payload.flashBaudRate"}}),r("v-spacer"),r("v-radio-group",{staticClass:"mt-0",attrs:{dense:"","hide-details":"",row:"",label:"Log level:"},model:{value:e.logLevel,callback:function(t){e.logLevel=t},expression:"logLevel"}},[r("v-radio",{attrs:{label:"INFO",value:"INFO"}}),r("v-radio",{attrs:{label:"VERBOSE",value:"VERBOSE"}}),r("v-radio",{attrs:{label:"DEBUG",value:"DEBUG"}})],1)],1):e._e(),e._l(e.logs.filter((function(t){var r=t.level;return e.logLevels[r]<=e.logLevels[e.logLevel]})),(function(t,a){return r("p",{key:a},["DEBUG"===e.logLevel?r("span",[e._v(e._s(t.ts))]):e._e(),e.logLevels[e.logLevel]>e.logLevels.INFO?r("span",{staticClass:"d-inline-block pl-2",staticStyle:{width:"4rem"}},[e._v(e._s(t.level))]):e._e(),e._v(" "+e._s(t.message)+" ")])})),r("v-dialog",{attrs:{persistent:"",width:"60%"},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.closePort.apply(null,arguments)}},model:{value:e.isWaitingForReset,callback:function(t){e.isWaitingForReset=t},expression:"isWaitingForReset"}},[r("v-card",[r("v-card-title",[r("span",[e._v("Waiting for MCU Power Cycle ...")]),r("v-spacer"),r("v-btn",{attrs:{small:"",icon:""},on:{click:e.closePort}},[r("v-icon",{attrs:{small:""}},[e._v("mdi-close")])],1)],1),r("v-card-text",[r("p",{staticClass:"font-weight-light mb-2"},[e._v("TIP: If the reset button does not work, try reconnect the GND wire. Or close this operation and try with another handshake baudrate.")]),r("v-progress-linear",{attrs:{indeterminate:""}})],1)],1)],1)],2)],1)],1)},n=[],s=r("2909"),i=r("1da1"),o=r("5530"),l=(r("96cf"),r("d3b7"),r("a630"),r("3ca3"),r("a15b"),r("ac1f"),r("466d"),r("25f0"),r("a434"),r("fb6a"),r("99af"),r("a9e3"),r("caad"),r("2532"),r("1c35")),u=r("69c7"),c=r.n(u),d={name:"ViewSTC15",data:function(){return{hex:null,port:null,isConnected:!1,reader:null,writer:null,rxBuffer:[],logs:[],flashChunk:128,bin:null,logLevels:{ERROR:0,WARN:1,INFO:2,VERBOSE:3,DEBUG:4},config:{baudRate:9600,dataBits:8,stopBits:1,parity:"even",flowControl:"none"},arg:0,fwver:0,forms:{setup:{payload:{handshakeBaudrate:2400,flashBaudRate:115200},isVisible:!1,handshakeBaudrates:[1200,2400,4800,9600,19200,38400,57600,115200],flashBaudRates:[1200,2400,4800,9600,19200,38400,57600,115200,230400]}},isWaitingForReset:!1,userAgent:"",isSerialUnsupported:!0,logLevel:"INFO"}},watch:{"forms.setup.payload.handshakeBaudrate":function(e){this.$router.push({query:Object(o["a"])(Object(o["a"])({},this.$route.query),{},{handshakeBaudrate:e})})},"forms.setup.payload.flashBaudRate":function(e){this.$router.push({query:Object(o["a"])(Object(o["a"])({},this.$route.query),{},{flashBaudRate:e})})}},methods:{log:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"INFO";this.logs.push({ts:Date.now(),level:t,message:e})},importTxt:function(){var e=this;if(this.hex){var t=new FileReader;t.onload=function(t){try{e.bin=null;var r=c.a.parse(t.target.result);e.bin=r.data,e.log("hex file loaded, length: ".concat(e.bin.length," bytes in binary"))}catch(a){e.log(a.message,"ERROR")}},t.readAsText(this.hex)}},readFromSerial:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.reader.read();case 2:if(a=t.sent,n=a.value,i=a.done,!i){t.next=7;break}return t.abrupt("return",Promise.resolve());case 7:return(r=e.rxBuffer).push.apply(r,Object(s["a"])(Array.from(n))),e.log("rx: ".concat(l["Buffer"].from(e.rxBuffer).toString("hex").match(/../g).join(" ")),"DEBUG"),t.abrupt("return",e.readFromSerial());case 10:case"end":return t.stop()}}),t)})))()},keepTrying:function(){var e=arguments,t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.transmit.apply(t,Object(s["a"])(e));case 3:return a=r.sent,r.abrupt("return",Promise.resolve(a));case 7:if(r.prev=7,r.t0=r["catch"](0),"timeout"!==r.t0.message){r.next=11;break}return r.abrupt("return",t.keepTrying.apply(t,Object(s["a"])(e)));case 11:throw r.t0;case 12:case"end":return r.stop()}}),r,null,[[0,7]])})))()},transmit:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return new Promise((function(a,n){var s=r+Math.ceil(11*e.length*1e3/t.config.baudRate);if(t.isConnected){t.rxBuffer.splice(0,t.rxBuffer.length);var i=0,o=Math.ceil(22e3/t.config.baudRate),u=0,c=setInterval((function(){var e=l["Buffer"].from(t.rxBuffer);e.length&&22===e.readUInt8(e.length-1)&&e.slice(0,3).equals(l["Buffer"].from([70,185,104]))&&e.readUInt16BE(3)+2===e.length&&e.slice(2,-3).reduce((function(e,t){return e+t}))===e.slice(-3,-1).readUInt16BE(0)?(clearInterval(c),t.log("rx: ".concat(e.toString("hex").match(/../g).join(" ")),"VERBOSE"),a(e)):i>s&&(e.length>u?(s+=o+o,u=e.length):(clearInterval(c),n(new Error("timeout")))),i+=o}),o);t.writer.write(e)}else n(new Error("port closed"))}))},reopenPort:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.port.open(e.config);case 2:e.isConnected=!0,e.reader=e.port.readable.getReader(),e.writer=e.port.writable.getWriter(),e.readFromSerial(),e.log("serial port opened at Baudrate ".concat(e.config.baudRate));case 7:case"end":return t.stop()}}),t)})))()},requestPort:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.serial.requestPort();case 2:e.port=t.sent;case 3:case"end":return t.stop()}}),t)})))()},closePort:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.reader.cancel();case 2:return t.next=4,e.reader.releaseLock();case 4:return t.next=6,e.writer.close();case 6:return t.next=8,e.writer.releaseLock();case 8:return t.next=10,e.port.close();case 10:e.isConnected=!1,e.isWaitingForReset=!1,e.log("serial port closed");case 13:case"end":return t.stop()}}),t)})))()},clear:function(){this.logs.splice(0,this.logs.length)},genCommand:function(e){var t=l["Buffer"].from([70,185,106,0,0]),r=l["Buffer"].alloc(2),a=l["Buffer"].from([22]),n=l["Buffer"].concat([t,l["Buffer"].from(e),r,a]);return n.writeUInt16BE(n.length-2,3),n.writeUInt16BE(n.slice(2,-3).reduce((function(e,t){return e+t})),n.length-3),this.log("tx: ".concat(n.toString("hex").match(/../g).join(" ")),"VERBOSE"),n},handshake:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.config.baudRate=e.forms.setup.payload.handshakeBaudrate,t.next=3,e.reopenPort();case 3:return e.log("intializing, Waiting for MCU, please cycle power ..."),e.isWaitingForReset=!0,t.next=7,e.keepTrying(l["Buffer"].from([127]));case 7:return r=t.sent,e.arg=r[9],e.fwver=r[22],e.isWaitingForReset=!1,t.abrupt("return",Promise.resolve(r));case 12:case"end":return t.stop()}}),t)})))()},readFuse:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.clear(),t.next=3,e.handshake();case 3:return r=t.sent,e.log("fuse: ".concat(r.toString("hex").match(/../g).join(" ")),"INFO"),t.next=7,e.closePort();case 7:case"end":return t.stop()}}),t)})))()},initial:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.handshake();case 2:return e.log("adjusting baudRate to ".concat(e.forms.setup.payload.flashBaudRate," ..."),"INFO"),r=Math.round(65536-6e6/e.forms.setup.payload.flashBaudRate),a=l["Buffer"].from([1,0,64,0,0,0,0,195]),a.writeUInt8(e.arg,1),a.writeUInt16BE(r,3),t.next=9,e.transmit(e.genCommand(a));case 9:return t.next=11,e.closePort();case 11:return e.config.baudRate=e.forms.setup.payload.flashBaudRate,t.next=14,e.reopenPort();case 14:return e.log("getting ready ...","INFO"),t.next=17,e.transmit(e.genCommand([5,0,0,90,165]));case 17:return e.log("erasing ...","INFO"),t.next=20,e.transmit(e.genCommand([3,0,0,90,165]),2e3);case 20:case"end":return t.stop()}}),t)})))()},flash:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.clear(),t.next=3,e.initial();case 3:return e.log("flashing ...","INFO"),r=l["Buffer"].from([34,0,0,90,165]),t.next=7,e._.chunk(e.bin,e.flashChunk).reduce(function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a,n){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,a;case 2:return s=t.sent,r.writeUInt16BE(s,1),t.next=6,e.transmit(e.genCommand(l["Buffer"].concat([r,l["Buffer"].from(n)])));case 6:return r.writeUInt8(2,0),e.log("".concat(s+n.length," bytes flashed"),"INFO"),t.abrupt("return",Promise.resolve(s+e.flashChunk));case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),Promise.resolve(0));case 7:return e.log("flashing completed","INFO"),t.abrupt("return",e.closePort());case 9:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.userAgent=navigator.userAgent,this.isSerialUnsupported=!navigator.serial;var e=Number(this.$route.query.handshakeBaudrate);this.forms.setup.handshakeBaudrates.includes(e)&&(this.forms.setup.payload.handshakeBaudrate=e);var t=Number(this.$route.query.flashBaudRate);this.forms.setup.flashBaudRates.includes(t)&&(this.forms.setup.payload.flashBaudRate=t)}},f=d,h=(r("a7cd"),r("2877")),p=Object(h["a"])(f,a,n,!1,null,"27d2765c",null);t["default"]=p.exports},a7cd:function(e,t,r){"use strict";r("116b")}}]);